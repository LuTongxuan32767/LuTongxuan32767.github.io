if(window.txqList){alert("txqList 冲突了！")}else{window.txqList={}}$.extend(txqList,{divImg:"imgDiv",friendUpdates:function(d,c,b,a){$.ajax({url:txqListConst.quanziAjaxUrl+"?method=queryDiandiList",type:"get",async:true,data:{fwFalg:d,pageNum:c,pageSize:b,myQuanzi:a},dataType:"json",success:function(e){if(e){if(e.list==null){$("#moreDt").css("display","");return false}if(c==1){$("#frindUpdatesId").html("")}$.each(e.list,function(n,t){var k="";var q=t.datetime.substring(0,4);var o=t.datetime.substring(4,6);var r=t.datetime.substring(6,8);var h=t.datetime.substring(9,11);var i=t.datetime.substring(12,14);var m=t.datetime.substring(15,17);var p=new Date(q,Number(o)-1,r,h,i,m);var j=new Date();var s=j.getTime()-p.getTime();var f="";if(s<3600000){f=parseInt(s/60000)+"分钟前"}else{if(s>=3600000&&s<86400000){f=parseInt(s/3600000)+"小时前"}else{if(s>=86400000&&s<259200000){f=parseInt(s/86400000)+"天前"}else{if(s>=259200000){f=q+"-"+o+"-"+r}}}}k+='<li><div class="qz_stu_profile"><img src="'+txqListConst.contextPath+"/web/common/fileShow.do?method=getXsImgFile&xsJbxxId="+t.eid+'" class="stu_profile_detail"></div><div class="qz_stu_affair"><div class="student_name">'+t.userName+"<small>"+f+'</small></div><div class="student_describe"  id="diandi_content'+t.id+'">';if(t.zlxx=="02"||t.zlxx=="03"||t.zlxx=="08"){k+='<img style="margin-left:10px" src="'+txqListConst.viewPath+'images/index/txq/zhi.png">'}else{if(t.zlxx=="04"||t.zlxx=="05"){k+='<img style="margin-left:10px" src="'+txqListConst.viewPath+'images/index/txq/de.png">'}else{if(t.zlxx=="10"||t.zlxx=="11"){k+='<img style="margin-left:10px" src="'+txqListConst.viewPath+'images/index/txq/ti.png">'}else{if(t.zlxx=="12"){k+='<img style="margin-left:10px" src="'+txqListConst.viewPath+'images/index/txq/mei.png">'}else{if(t.zlxx=="13"){k+='<img style="margin-left:10px" src="'+txqListConst.viewPath+'images/index/txq/lao.png">'}else{if(t.zlxx=="14"){k+='<img style="margin-left:10px" src="'+txqListConst.viewPath+'images/index/txq/chenshu.png">'}}}}}}k+="</div>";$.each(t.fileAttach,function(u,v){if(".png,.gif,.jpg,.jpeg,.JPG,.JPEG,.PNG,.GIF".indexOf(v.fileType)!=-1){k+='<img src="'+txqListConst.quanziAjaxUrl+"?method=getFile&fileId="+v.fileId+"&fileType="+v.fileType+'"  class="lightsGal student_update">'}else{k+='<img src="'+txqListConst.viewPath+'images/ypt/default_video_success.png" fileId="'+v.fileId+'" fileType="'+v.fileType+'" class="lightsGalVideo student_update">'}});k+='<div class="operation_show clearfix"><div class="praise_name"><ul>';var g=false;if(t.dianZanList!=null&&t.dianZanList.length>0){var l=t.dianZanList.length;$.each(t.dianZanList,function(v,u){k+="<li>"+u.name;if((l>5&&v!=4)||(l<=5&&v!=l-1)){k+=","}k+="</li>";if(v==4||v==l-1){k+='<li>等<a href="javascript:void(0);"  onclick="txqList.queryDianZanMore(\''+t.id+"',this);\">"+l+"</a>人已赞</li>";return false}});$.each(t.dianZanList,function(v,u){if(t.userName=u.name){g=true;return false}})}k+='</ul></div><div class="praise_comment">';if(t.isDianZan=="0"){k+='<span eid="'+t.eid+'" onclick="txqList.deleteDianZan(\''+t.id+'\',this)"><i class="fa fa-thumbs-up "></i>取消赞</span><em>|</em>'}else{k+='<span eid="'+t.eid+'" onclick="txqList.addDianZan(\''+t.id+'\',this)"><i class="fa fa-thumbs-up "></i>赞</span><em>|</em>'}k+='<span onclick="txqList.showPingLunInput(this)"><i class="fa fa-pencil-square-o"></i>评论</span>';if(txqListConst.bzrFlag){k+="<span onclick=\"txqList.deleteDiandi('"+t.id+'\')"><i class="fa fa-pencil-square-o"></i>删除</span>'}if(t.isDelete=="1"){k+="<span onclick=\"txqList.deleteDiandi('"+t.id+'\')"><i class="fa fa-pencil-square-o"></i>删除</span>'}k+='</div></div><div class="other_comment clearfix">';if(t.pingLunList!=null&&t.pingLunList.length>0){$.each(t.pingLunList,function(v,u){k+="<div class=\"other_com_show clearfix\"><span style='color: #1ca5fc;  margin-right: 5px;'>"+u.name+":</span>"+txqList.replaceBackslash(_.unescape(u.content));if(u.isDelete=="1"){k+="<span style='float:right;cursor:pointer' onclick=\"txqList.deletePingLun('"+u.id+"','"+t.id+'\',this)"><i class="fa fa-pencil-square-o"></i>删除</span>'}k+="</div>"})}k+='</div></div><div class="pop_com_write" style="display:none"><div id="sr'+t.id+'" class="p_s_c_write" style="width: 783.44px;float: left;overflow-y:auto;" contenteditable="true"></div><div class="btn_publish" style="cursor:pointer;" onclick="txqList.addPingLun(\''+t.id+'\',this)">发表</div><br/><div><span><img id="biaoqingImg" style="float:left" src="/zhszpj/themes/default/zhszpj/skins/images/ypt/icon_bq.png" onclick="txqList.biaoqing(\''+t.id+"',this)\"></span></div></div></li>";$("#frindUpdatesId").append(k);$("#diandi_content"+t.id).text(txqList.replaceBackslash(_.unescape(t.content)))});if(e.list.length==0){$("#moreDt").css("display","")}else{$("#moreDt").css("display","none")}}},error:function(e){},})},deleteDiandi:function(a){bootbox.confirm("确定要删除此说说吗?",function(b){if(b){$.ajax({url:txqListConst.quanziAjaxUrl+"?method=deleteDiandiById",type:"get",data:{communityId:a},dataType:"json",success:function(c){if(c=="success"){E5.Msg.alert("删除成功！",function(){txqList.friendUpdates("1","1","10","1")})}if(c=="error"){E5.Msg.alert("删除失败！")}},error:function(c){E5.Msg.alert("删除失败！")}})}})},deletePingLun:function(c,a,b){bootbox.confirm("确定要删除此评论吗?",function(d){$.ajax({url:txqListConst.pingLunAjaxUrl+"?method=deletePingLun",type:"get",data:{communityId:a,id:c},dataType:"json",success:function(e){if(null!=e&&e!=""){if(e.isSuccess=="success"){$(b).parent().css("display","none");E5.Msg.alert("删除成功！",function(){})}else{E5.Msg.alert("删除失败！")}}},error:function(e){E5.Msg.alert("删除失败！")}})})},replaceBackslash:function(a){return a.replace(/\\/g,"")},addDianZan:function(a,b){$.ajax({url:txqListConst.dianZanAjaxUrl+"?method=addDianZan",type:"post",data:{communityId:a},dataType:"json",success:function(c){txqList.queryDianZan(a,b);$(b).attr("onclick",$(b).attr("onclick").replace("add","delete"));$(b).html('<i class="fa fa-thumbs-up "></i>取消赞')},error:function(c){E5.Msg.alert("点赞失败！")},})},deleteDianZan:function(b,c){var a=$(c).attr("eid");$.ajax({url:txqListConst.dianZanAjaxUrl+"?method=deleteDianZan",type:"get",data:{communityId:b,eid:a},dataType:"json",success:function(d){txqList.queryDianZan(b,c);$(c).attr("onclick",$(c).attr("onclick").replace("delete","add"));$(c).html('<i class="fa fa-thumbs-up "></i>赞')},error:function(d){E5.Msg.alert("取消赞失败！")},})},queryDianZan:function(a,b){$.ajax({url:txqListConst.dianZanAjaxUrl+"?method=queryDianZan",type:"get",data:{communityId:a},async:false,dataType:"json",success:function(d){var c="";if(d.data==null){return false}var e=d.data.length;$.each(d.data,function(g,h){c+="              <li>"+h.name;if((e>5&&g!=4)||(e<=5&&g!=e-1)){c+=","}c+="</li>";if(g==4||g==e-1){c+='              <li onclick="txqList" >等<a href="javascript:void(0);" onclick="txqList.queryDianZanMore(\''+a+"',this);\">"+e+"</a>人已赞</li>";return false}});var f=$(b).parent().parent().find(".praise_name").find("ul");f.html("");f.html(c)},error:function(c){E5.Msg.alert("查询点赞列表失败！")},})},queryDianZanMore:function(a,b){$.ajax({url:txqListConst.dianZanAjaxUrl+"?method=queryDianZan",type:"get",data:{communityId:a},async:false,dataType:"json",success:function(d){if(d.data==null){return false}var c="";var e=d.data.length;$.each(d.data,function(g,h){c+="              <li>"+h.name;if(g!=e-1){c+=","}c+="</li>";if(g==e-1){c+='              <li onclick="txqList" >等<a href="javascript:void(0);" onclick="txqList.queryDianZan(\''+a+"',this);\">"+e+"</a>人已赞</li>";return false}});var f=$(b).parent().parent();f.html("");f.html(c)},error:function(c){E5.Msg.alert("查询点赞列表失败！")},})},showPingLunInput:function(b){var a=$(b).parent().parent().parent().parent().find(".pop_com_write");if(a.css("display")=="none"){a.css("display","")}else{a.css("display","none")}},addPingLun:function(f,g){var c=$(g).parent();var a=$(g).parent().parent();var b=$(g).parent().find(".p_s_c_write");var e=jQuery.trim(b.html());if(e==""){E5.Msg.alert("请输入评论内容！",function(){b.focus()});return false}var d="0";var h="";$.ajax({url:txqListConst.pingLunAjaxUrl+"?method=addPingLun",type:"post",data:{communityId:f,content:e,plzx:d,level:h},dataType:"json",success:function(i){txqList.queryPingLun(f,g);b.html("");b.parent().css("display","none");$(g).parent().css("display","none")},error:function(i){E5.Msg.alert("添加评论失败！")},})},queryPingLun:function(a,b){$.ajax({url:txqListConst.pingLunAjaxUrl+"?method=queryPingLun",type:"get",data:{communityId:a},dataType:"json",success:function(d){var c="";$.each(d.data,function(f,g){c+="<div class=\"other_com_show clearfix\"><span style='color: #1ca5fc;  margin-right: 5px;'>"+g.name+":</span>"+txqList.replaceBackslash(_.unescape(g.content));if(g.isDelete=="1"){c+="<span style='float:right;cursor:pointer' onclick=\"txqList.deletePingLun('"+g.id+"','"+a+'\',this)"><i class="fa fa-pencil-square-o"></i>删除</span>'}c+="</div>"});var e=$(b).parent().parent().find(".other_comment");e.html("");e.html(c)},error:function(c){E5.Msg.alert("查询评论失败！")},})},biaoqing:function(g,c){var h="/zhszpj/themes/default/zhszpj/skins/images/ypt/arclist/";var j="sr"+g;var a,e;if($("#"+txqList.divImg).length<=0){a='<div id="'+txqList.divImg+'" style="position:absolute;display:none;z-index:1000;" class="qqFace"><table border="0" cellspacing="0" cellpadding="0" ><tr>';for(var d=1;d<=75;d++){e="[em_"+d+"]";a+='<td><img src="'+h+d+'.gif" onclick="$(\'#'+j+"').insertCaret('"+e+"','"+j+"','"+txqList.divImg+"');\" /></td>";if(d%15==0){a+="</tr><tr>"}}a+="</tr></table></div>"}$(c).parent().append(a);var b=$(c).position();var f=b.top+$(c).outerHeight();$("#"+txqList.divImg).css("top",f);$("#"+txqList.divImg).css("left",b.left);$("#"+txqList.divImg).show()}});$(function(){var a=$(".pic_big");$(".fieldset").delegate(".lightsGal","click",function(){var b=$(this).attr("src");$(".scale_pic img").attr("src",b);a.fadeIn(200)});a.click(function(b){$(".scale_pic img").attr("src","");a.fadeOut(200)})});jQuery.fn.extend({selectContents:function(){$(this).each(function(b){var d=this;var c,a,f,e;if((f=d.ownerDocument)&&(e=f.defaultView)&&typeof e.getSelection!="undefined"&&typeof f.createRange!="undefined"&&(c=window.getSelection())&&typeof c.removeAllRanges!="undefined"){a=f.createRange();a.selectNode(d);if(b==0){c.removeAllRanges()}c.addRange(a)}else{if(document.body&&typeof document.body.createTextRange!="undefined"&&(a=document.body.createTextRange())){a.moveToElementText(d);a.select()}}})},insertCaret:function(b,d,a){var c=window.getSelection().getRangeAt(0);var e=document.createElement("img");e.setAttribute("src",dbrws.protocol+"//"+dbrws.host+dbrws.viewPath+"images/ypt/arclist/"+b.substring(4,b.lastIndexOf("]"))+".gif");$("#"+d).append(e);$("#"+d).focus();if(document.selection){}else{if(window.getSelection){}}$("#"+a).remove()}});